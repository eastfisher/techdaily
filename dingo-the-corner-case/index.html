<!DOCTYPE html>
<html lang="en">
    <head>
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <meta http-equiv="content-type" content="text/html; charset=utf-8">

      <!-- Enable responsiveness on mobile devices-->
      <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

      <title>My Blogs - Dingo入坑指南</title>

      
        <link rel="alternate" type="application/atom+xml" title="RSS" href="https://eastfisher.github.io/blg/atom.xml">
      

      
          <script src="https://cdnjs.cloudflare.com/ajax/libs/slideout/1.0.1/slideout.min.js"></script>
          
      

      
          <link rel="stylesheet" href="https:&#x2F;&#x2F;eastfisher.github.io&#x2F;blg&#x2F;site.css">
          
      

      
<script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?29971f31a53cc2ca313719de9914d280";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
</script>

    </head>

    <body>
        <div class="container">

            <div id="mobile-navbar" class="mobile-navbar">
              <div class="mobile-header-logo">
                <a href="/" class="logo">My Blogs</a>
              </div>
              <div class="mobile-navbar-icon icon-out">
                <span></span>
                <span></span>
                <span></span>
              </div>
            </div>

            <nav id="mobile-menu" class="mobile-menu slideout-menu slideout-menu-left">
              <ul class="mobile-menu-list">
                
                    <li class="mobile-menu-item">
                        <a href="https:&#x2F;&#x2F;eastfisher.github.io&#x2F;blg">
                            Home
                        </a>
                    </li>
                
                    <li class="mobile-menu-item">
                        <a href="https:&#x2F;&#x2F;eastfisher.github.io&#x2F;blg&#x2F;categories">
                            Categories
                        </a>
                    </li>
                
                    <li class="mobile-menu-item">
                        <a href="https:&#x2F;&#x2F;eastfisher.github.io&#x2F;blg&#x2F;tags">
                            Tags
                        </a>
                    </li>
                
                    <li class="mobile-menu-item">
                        <a href="https:&#x2F;&#x2F;eastfisher.github.io&#x2F;blg&#x2F;about">
                            About
                        </a>
                    </li>
                
              </ul>
            </nav>

            <header id="header">
                <div class="logo"><a href="https:&#x2F;&#x2F;eastfisher.github.io&#x2F;blg">My Blogs</a></div>
                <nav class="menu">
                    <ul>
                        
                            <li>
                                <a href="https:&#x2F;&#x2F;eastfisher.github.io&#x2F;blg">
                                    Home
                                </a>
                            </li>
                        
                            <li>
                                <a href="https:&#x2F;&#x2F;eastfisher.github.io&#x2F;blg&#x2F;categories">
                                    Categories
                                </a>
                            </li>
                        
                            <li>
                                <a href="https:&#x2F;&#x2F;eastfisher.github.io&#x2F;blg&#x2F;tags">
                                    Tags
                                </a>
                            </li>
                        
                            <li>
                                <a href="https:&#x2F;&#x2F;eastfisher.github.io&#x2F;blg&#x2F;about">
                                    About
                                </a>
                            </li>
                        
                    </ul>
                </nav>
            </header>

            <main>
                <div class="content" id="mobile-panel">
                    


<div class="post-toc" id="post-toc">
    <h2 class="post-toc-title">Contents</h2>
    <div class="post-toc-content always-active">
        <nav id="TableOfContents">
            <ul>
                
                <li>
                    <a href="https://eastfisher.github.io/blg/dingo-the-corner-case/#jian-jie" class="toc-link">简介</a>
                    
                </li>
                
                <li>
                    <a href="https://eastfisher.github.io/blg/dingo-the-corner-case/#ji-ben-yong-fa" class="toc-link">基本用法</a>
                    
                </li>
                
                <li>
                    <a href="https://eastfisher.github.io/blg/dingo-the-corner-case/#chang-jian-de-keng" class="toc-link">常见的坑</a>
                    
                    <ul>
                        
                        <li>
                            <a href="https://eastfisher.github.io/blg/dingo-the-corner-case/#lei-xing-sheng-ming-wen-ti" class="toc-link">类型声明问题</a>
                        </li>
                        
                        <li>
                            <a href="https://eastfisher.github.io/blg/dingo-the-corner-case/#dan-li-wen-ti" class="toc-link">单例问题</a>
                        </li>
                        
                        <li>
                            <a href="https://eastfisher.github.io/blg/dingo-the-corner-case/#beanke-jian-xing" class="toc-link">Bean可见性</a>
                        </li>
                        
                        <li>
                            <a href="https://eastfisher.github.io/blg/dingo-the-corner-case/#yi-lai-zhu-ru-zheng-que-xing" class="toc-link">依赖注入正确性</a>
                        </li>
                        
                    </ul>
                    
                </li>
                
                <li>
                    <a href="https://eastfisher.github.io/blg/dingo-the-corner-case/#zong-jie-yi-xia" class="toc-link">总结一下</a>
                    
                </li>
                
                <li>
                    <a href="https://eastfisher.github.io/blg/dingo-the-corner-case/#can-kao-zi-liao" class="toc-link">参考资料</a>
                    
                </li>
                
            </ul>
        </nav>
    </div>
</div>


<article class="post">
    
    <header class="post__header">
        <h1 class="post__title">
            <a href="https:&#x2F;&#x2F;eastfisher.github.io&#x2F;blg&#x2F;dingo-the-corner-case&#x2F;">Dingo入坑指南</a>
        </h1>
        <div class="post__meta">
            <span class="post__time">2021-06-09</span>
            
        </div>
    </header>

    <div class="post-content">
      <p>最近转组去了业务开发团队, 公司主语言采用Go, 且服务治理体系, 各种SDK等基础设施基本上只提供了Go语言的版本. 个人认为, 实现大型复杂项目的开发, 依赖注入 (Dependency Injection, DI) 框架还是非常有必要的. 对于Java语言来说, 使用Spring全家桶进行业务开发, 自然就拥有了Spring框架提供的IoC能力. 然而Go在这方面的差距还是比较明显的, 使用Go语言进行业务开发的案例本身就比较少, DI的最佳实践就更少了. 而且除了Uber的 <a href="https://github.com/uber-go/dig">Dig</a>, Google的 <a href="https://github.com/google/wire">Wire</a>, 鲜有其他成熟的开源DI框架可用. 不过就在最近, 我发现了一个宝藏项目, 它就是<a href="https://github.com/i-love-flamingo/dingo">Dingo</a>.</p>
<span id="continue-reading"></span><h2 id="jian-jie">简介</h2>
<p>Dingo框架的关注度不高, 只有100+ star. 在github搜索dingo, 需要翻到第2页的末尾才能找到这个项目. Dingo框架归属于一个叫作<code>i-love-flamingo</code>的组织, 该组织提供了一个开源的Web开发框架, 名叫Flamingo (关注度同样不高), 并基于该框架实现了一个简版电商平台demo. 而Dingo就是Flamingo的DI容器实现, 有点类似于Spring MVC和Spring的关系.</p>
<p>Dingo是基于反射机制实现的DI框架, 可通过 struct tag 和 Inject()回调方法 两种方式声明依赖注入.</p>
<p>Dingo代码量很少, 逻辑也和Google的 <a href="https://github.com/google/guice">Guice</a> (发音同juice) 非常相像, 有Java DI框架使用经验的话应该会很容易上手.</p>
<h2 id="ji-ben-yong-fa">基本用法</h2>
<p>了解3个概念即可使用Dingo: Dependency, Module, Injector. Dependency即为依赖, Module用来声明依赖的绑定关系, Injector为Dingo提供的DI容器. 给个例子:</p>
<pre style="background-color:#2b303b;">
<code class="language-go" data-lang="go"><span style="color:#b48ead;">package </span><span style="color:#bf616a;">main

</span><span style="color:#b48ead;">import </span><span style="color:#c0c5ce;">(
    &quot;</span><span style="color:#a3be8c;">context</span><span style="color:#c0c5ce;">&quot;
    &quot;</span><span style="color:#a3be8c;">log</span><span style="color:#c0c5ce;">&quot;

    &quot;</span><span style="color:#a3be8c;">flamingo.me/dingo</span><span style="color:#c0c5ce;">&quot;
)

</span><span style="color:#b48ead;">type </span><span style="color:#c0c5ce;">User </span><span style="color:#b48ead;">struct</span><span style="color:#c0c5ce;">{
    </span><span style="color:#bf616a;">Id </span><span style="color:#b48ead;">int64
</span><span style="color:#c0c5ce;">}

</span><span style="color:#b48ead;">type </span><span style="color:#c0c5ce;">IUserRepo </span><span style="color:#b48ead;">interface </span><span style="color:#c0c5ce;">{
    </span><span style="color:#8fa1b3;">FindById</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">context</span><span style="color:#c0c5ce;">.</span><span style="color:#b48ead;">Context</span><span style="color:#c0c5ce;">, </span><span style="color:#b48ead;">int64</span><span style="color:#c0c5ce;">) (*</span><span style="color:#b48ead;">User</span><span style="color:#c0c5ce;">, </span><span style="color:#b48ead;">error</span><span style="color:#c0c5ce;">)
}

</span><span style="color:#65737e;">// IUserRepo的内存型实现
</span><span style="color:#b48ead;">type </span><span style="color:#c0c5ce;">InMemoryUserRepo </span><span style="color:#b48ead;">struct </span><span style="color:#c0c5ce;">{
}

</span><span style="color:#b48ead;">func </span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">ur </span><span style="color:#c0c5ce;">*</span><span style="color:#b48ead;">InMemoryUserRepo</span><span style="color:#c0c5ce;">) </span><span style="color:#8fa1b3;">FindById</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">ctx context</span><span style="color:#c0c5ce;">.</span><span style="color:#b48ead;">Context</span><span style="color:#c0c5ce;">, </span><span style="color:#bf616a;">userId </span><span style="color:#b48ead;">int64</span><span style="color:#c0c5ce;">) (*</span><span style="color:#b48ead;">User</span><span style="color:#c0c5ce;">, </span><span style="color:#b48ead;">error</span><span style="color:#c0c5ce;">) {
    </span><span style="color:#b48ead;">return </span><span style="color:#c0c5ce;">&amp;</span><span style="color:#bf616a;">User</span><span style="color:#c0c5ce;">{</span><span style="color:#bf616a;">Id</span><span style="color:#c0c5ce;">: </span><span style="color:#bf616a;">userId</span><span style="color:#c0c5ce;">}, </span><span style="color:#d08770;">nil
</span><span style="color:#c0c5ce;">}

</span><span style="color:#65737e;">// 用户服务, 需要注入IUserRepo接口
</span><span style="color:#b48ead;">type </span><span style="color:#c0c5ce;">UserService </span><span style="color:#b48ead;">struct </span><span style="color:#c0c5ce;">{
    </span><span style="color:#bf616a;">UserRepo </span><span style="color:#b48ead;">IUserRepo </span><span style="color:#c0c5ce;">`</span><span style="color:#a3be8c;">inject:&quot;&quot;</span><span style="color:#c0c5ce;">`
}

</span><span style="color:#b48ead;">func </span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">us </span><span style="color:#c0c5ce;">*</span><span style="color:#b48ead;">UserService</span><span style="color:#c0c5ce;">) </span><span style="color:#8fa1b3;">CheckUserExist</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">ctx context</span><span style="color:#c0c5ce;">.</span><span style="color:#b48ead;">Context</span><span style="color:#c0c5ce;">, </span><span style="color:#bf616a;">userId </span><span style="color:#b48ead;">int64</span><span style="color:#c0c5ce;">) (</span><span style="color:#b48ead;">bool</span><span style="color:#c0c5ce;">, </span><span style="color:#b48ead;">error</span><span style="color:#c0c5ce;">) {
    </span><span style="color:#bf616a;">user</span><span style="color:#c0c5ce;">, </span><span style="color:#bf616a;">err </span><span style="color:#c0c5ce;">:= </span><span style="color:#bf616a;">us</span><span style="color:#c0c5ce;">.</span><span style="color:#bf616a;">UserRepo</span><span style="color:#c0c5ce;">.</span><span style="color:#bf616a;">FindById</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">ctx</span><span style="color:#c0c5ce;">, </span><span style="color:#bf616a;">userId</span><span style="color:#c0c5ce;">)
    </span><span style="color:#b48ead;">if </span><span style="color:#bf616a;">err </span><span style="color:#c0c5ce;">!= </span><span style="color:#d08770;">nil </span><span style="color:#c0c5ce;">{</span><span style="color:#b48ead;">return </span><span style="color:#d08770;">false</span><span style="color:#c0c5ce;">, </span><span style="color:#bf616a;">err</span><span style="color:#c0c5ce;">}
    </span><span style="color:#b48ead;">return </span><span style="color:#bf616a;">user </span><span style="color:#c0c5ce;">!= </span><span style="color:#d08770;">nil</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">nil
</span><span style="color:#c0c5ce;">}

</span><span style="color:#b48ead;">type </span><span style="color:#c0c5ce;">Module </span><span style="color:#b48ead;">struct </span><span style="color:#c0c5ce;">{
}

</span><span style="color:#65737e;">// 声明依赖的绑定关系
</span><span style="color:#b48ead;">func </span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">m </span><span style="color:#c0c5ce;">*</span><span style="color:#b48ead;">Module</span><span style="color:#c0c5ce;">) </span><span style="color:#8fa1b3;">Configure</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">injector </span><span style="color:#c0c5ce;">*</span><span style="color:#bf616a;">dingo</span><span style="color:#c0c5ce;">.</span><span style="color:#b48ead;">Injector</span><span style="color:#c0c5ce;">) {
    </span><span style="color:#bf616a;">injector</span><span style="color:#c0c5ce;">.</span><span style="color:#bf616a;">Bind</span><span style="color:#c0c5ce;">(</span><span style="color:#96b5b4;">new</span><span style="color:#c0c5ce;">(</span><span style="color:#b48ead;">IUserRepo</span><span style="color:#c0c5ce;">)).</span><span style="color:#bf616a;">To</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">InMemoryUserRepo</span><span style="color:#c0c5ce;">{})
}

</span><span style="color:#b48ead;">func </span><span style="color:#8fa1b3;">main</span><span style="color:#c0c5ce;">() {
    </span><span style="color:#bf616a;">injector</span><span style="color:#c0c5ce;">, </span><span style="color:#bf616a;">_ </span><span style="color:#c0c5ce;">:= </span><span style="color:#bf616a;">dingo</span><span style="color:#c0c5ce;">.</span><span style="color:#bf616a;">NewInjector</span><span style="color:#c0c5ce;">(
        </span><span style="color:#96b5b4;">new</span><span style="color:#c0c5ce;">(</span><span style="color:#b48ead;">Module</span><span style="color:#c0c5ce;">),
    )

    </span><span style="color:#bf616a;">userServiceObj</span><span style="color:#c0c5ce;">, </span><span style="color:#bf616a;">_ </span><span style="color:#c0c5ce;">:= </span><span style="color:#bf616a;">injector</span><span style="color:#c0c5ce;">.</span><span style="color:#bf616a;">GetInstance</span><span style="color:#c0c5ce;">((*</span><span style="color:#bf616a;">UserService</span><span style="color:#c0c5ce;">)(</span><span style="color:#d08770;">nil</span><span style="color:#c0c5ce;">))
    </span><span style="color:#bf616a;">log</span><span style="color:#c0c5ce;">.</span><span style="color:#bf616a;">Println</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">userServiceObj</span><span style="color:#c0c5ce;">.(*</span><span style="color:#b48ead;">UserService</span><span style="color:#c0c5ce;">).</span><span style="color:#bf616a;">CheckUserExist</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">context</span><span style="color:#c0c5ce;">.</span><span style="color:#bf616a;">Background</span><span style="color:#c0c5ce;">(), </span><span style="color:#d08770;">1</span><span style="color:#c0c5ce;">))
}
</span></code></pre>
<p>上面的代码创建了一个Module, 里面声明了一个IUserRepo到InMemoryUserRepo的绑定关系. 在main中, 我们创建了Dingo的Injector容器, 并获取了一个UserService对象, 由于通过struct tag声明了UserRepo的注入, 因此容器会自动帮我们注入一个IUserRepo实例, 也就是在Module中声明的InMemoryUserRepo对象. 该对象是由Injector自动创建的. 请求注入时, 注入的对象由 <a href="https://github.com/eastfisher/dingo/tree/reading#requesting-injection">这个规则</a> 进行控制.</p>
<p>此外, Injector API还提供了诸如具名绑定, Eager绑定, Provider, 父子容器等功能, 看一遍文档就差不多能明白了.</p>
<p>Dingo还提供了拦截器 (Interception) 的功能, 但是与AOP完全无关, 就是个基于interface的装饰器, 除了某些特定场景以外 (比如web框架的HTTP middleware), 基本没啥用, 和Spring AOP差了十万八千里.</p>
<h2 id="chang-jian-de-keng">常见的坑</h2>
<p>一开始使用dingo时经常会遇到依赖绑定失败发生panic的问题. 在此给出一些常见的case.</p>
<h3 id="lei-xing-sheng-ming-wen-ti">类型声明问题</h3>
<p>Dingo在做类型Binding, 以及GetInstance操作时, 都需要声明对象类型. 这就相当于Spring反射获取对象时传入class对象. 待绑定的对象是接口还是非接口, 有一些区别. 对于接口的绑定, 在声明时需要使用<code>new(接口)</code>从而得到接口类型指针, dingo才能在反射时获取接口类型. 如果声明成<code>(接口)(nil)</code>, 得到的是nil指针, dingo反射时无法获取接口类型, 会报panic.</p>
<pre style="background-color:#2b303b;">
<code class="language-go" data-lang="go"><span style="color:#b48ead;">func </span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">m </span><span style="color:#c0c5ce;">*</span><span style="color:#b48ead;">Module</span><span style="color:#c0c5ce;">) </span><span style="color:#8fa1b3;">Configure</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">injector </span><span style="color:#c0c5ce;">*</span><span style="color:#bf616a;">dingo</span><span style="color:#c0c5ce;">.</span><span style="color:#b48ead;">Injector</span><span style="color:#c0c5ce;">) {
    </span><span style="color:#bf616a;">injector</span><span style="color:#c0c5ce;">.</span><span style="color:#bf616a;">Bind</span><span style="color:#c0c5ce;">(</span><span style="color:#96b5b4;">new</span><span style="color:#c0c5ce;">(</span><span style="color:#b48ead;">IUserRepo</span><span style="color:#c0c5ce;">)).</span><span style="color:#bf616a;">To</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">InMemoryUserRepo</span><span style="color:#c0c5ce;">{})    </span><span style="color:#65737e;">// OK
    </span><span style="color:#bf616a;">injector</span><span style="color:#c0c5ce;">.</span><span style="color:#bf616a;">Bind</span><span style="color:#c0c5ce;">((</span><span style="color:#bf616a;">IUserRepo</span><span style="color:#c0c5ce;">)(</span><span style="color:#d08770;">nil</span><span style="color:#c0c5ce;">)).</span><span style="color:#bf616a;">To</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">InMemoryUserRepo</span><span style="color:#c0c5ce;">{})  </span><span style="color:#65737e;">// Panic, 接口类型的nil指针, 其类型为nil
    </span><span style="color:#bf616a;">injector</span><span style="color:#c0c5ce;">.</span><span style="color:#bf616a;">Bind</span><span style="color:#c0c5ce;">((*</span><span style="color:#bf616a;">InMemoryUserRepo</span><span style="color:#c0c5ce;">)(</span><span style="color:#d08770;">nil</span><span style="color:#c0c5ce;">)).</span><span style="color:#bf616a;">ToInstance</span><span style="color:#c0c5ce;">(&amp;</span><span style="color:#bf616a;">InMemoryUserRepo</span><span style="color:#c0c5ce;">{}) </span><span style="color:#65737e;">// OK
</span><span style="color:#c0c5ce;">}

</span><span style="color:#b48ead;">func </span><span style="color:#8fa1b3;">main</span><span style="color:#c0c5ce;">() {
    ......
    </span><span style="color:#b48ead;">var </span><span style="color:#bf616a;">repoObj </span><span style="color:#b48ead;">interface</span><span style="color:#c0c5ce;">{}
    </span><span style="color:#bf616a;">repoObj</span><span style="color:#c0c5ce;">, </span><span style="color:#bf616a;">_ </span><span style="color:#c0c5ce;">= </span><span style="color:#bf616a;">injector</span><span style="color:#c0c5ce;">.</span><span style="color:#bf616a;">GetInstance</span><span style="color:#c0c5ce;">(</span><span style="color:#96b5b4;">new</span><span style="color:#c0c5ce;">(</span><span style="color:#b48ead;">IUserRepo</span><span style="color:#c0c5ce;">))   </span><span style="color:#65737e;">// OK
    </span><span style="color:#bf616a;">repoObj</span><span style="color:#c0c5ce;">, </span><span style="color:#bf616a;">_ </span><span style="color:#c0c5ce;">= </span><span style="color:#bf616a;">injector</span><span style="color:#c0c5ce;">.</span><span style="color:#bf616a;">GetInstance</span><span style="color:#c0c5ce;">((</span><span style="color:#bf616a;">IUserRepo</span><span style="color:#c0c5ce;">)(</span><span style="color:#d08770;">nil</span><span style="color:#c0c5ce;">)) </span><span style="color:#65737e;">// Panic, nil类型
    </span><span style="color:#bf616a;">repoObj</span><span style="color:#c0c5ce;">, </span><span style="color:#bf616a;">_ </span><span style="color:#c0c5ce;">= </span><span style="color:#bf616a;">injector</span><span style="color:#c0c5ce;">.</span><span style="color:#bf616a;">GetInstance</span><span style="color:#c0c5ce;">(</span><span style="color:#96b5b4;">new</span><span style="color:#c0c5ce;">(</span><span style="color:#b48ead;">InMemoryUserRepo</span><span style="color:#c0c5ce;">))    </span><span style="color:#65737e;">// OK
    </span><span style="color:#bf616a;">repoObj</span><span style="color:#c0c5ce;">, </span><span style="color:#bf616a;">_ </span><span style="color:#c0c5ce;">= </span><span style="color:#bf616a;">injector</span><span style="color:#c0c5ce;">.</span><span style="color:#bf616a;">GetInstance</span><span style="color:#c0c5ce;">((*</span><span style="color:#bf616a;">InMemoryUserRepo</span><span style="color:#c0c5ce;">)(</span><span style="color:#d08770;">nil</span><span style="color:#c0c5ce;">)) </span><span style="color:#65737e;">// OK
</span><span style="color:#c0c5ce;">}
</span></code></pre><h3 id="dan-li-wen-ti">单例问题</h3>
<p>有3种方式可以实现单例:</p>
<ul>
<li>1 使用 ToInstance() 绑定到某个对象</li>
<li>2 使用 ToProvider() 绑定并提供单例 Provider</li>
<li>3 使用 In(dingo.Singleton) 将绑定声明为单例
<ul>
<li>可使用 AsEagerSingleton() 对单例进行及时加载</li>
</ul>
</li>
</ul>
<p>其中, 第1种方式与及时加载的第3种方式非常类似. 第2种方式与延迟加载的第3种方式非常类似, 区别在于需要自己控制加锁.</p>
<p>第1, 2种方式可以自己控制单例对象的实例化, 而第3种方式只能使用new()进行对象初始化, 如果其中声明了依赖, 会自动注入. 对于那些需要控制对象创建过程的对象 (例如, 数据库连接池对象), 只能采用第1, 2种方式.</p>
<h3 id="beanke-jian-xing">Bean可见性</h3>
<p>Dingo提供了父子容器的功能, 父容器中的Bean对子容器可见, 反之不成立. 这与Spring MVC和Spring的父子容器是一样的: Spring父容器中的Component, Service对MVC容器的Controller可见, 而MVC容器的Controller对Service不可见.</p>
<h3 id="yi-lai-zhu-ru-zheng-que-xing">依赖注入正确性</h3>
<p>对struct中的接口属性字段, 可使用无名inject进行注入. 原因: 必须声明interface到某个具体类型的binding后, dingo才能处理.</p>
<p>对struct中的非接口属性字段, 建议使用具名inject进行注入. 原因: 对非接口对象, dingo如果找不到任何提供该对象的工厂, 则会使用反射创建空值对象. 这有可能导致该对象并没有正确创建. 而对于具名inject注入, 如果不显式声明binding, 则会在依赖注入过程中由于找不到对应annotation的bean而报错, 从而对注入的正确性进行约束.</p>
<h2 id="zong-jie-yi-xia">总结一下</h2>
<p>当时在发现Dingo时我是非常惊喜的, 它恰到好处地解决了我在使用Go编写复杂业务代码时的依赖注入问题. Dingo提供的API非常符合Java转Go开发者的使用习惯. 而上面提到的坑, 与其说是踩坑, 不如说是对Go的反射机制理解不足 (以及Go的反射确实比较烂? 逃...). 我们已经在生产环境中使用Dingo进行微服务开发, 体验良好.</p>
<h2 id="can-kao-zi-liao">参考资料</h2>
<ul>
<li><a href="https://github.com/i-love-flamingo/dingo">Dingo代码仓库</a></li>
<li><a href="https://github.com/eastfisher/dingo/tree/reading">我的Dingo源码阅读笔记</a></li>
</ul>

    </div>

    
<div class="post-comment">
  <script src="https://utteranc.es/client.js"
    repo="eastfisher/blg"
    issue-term="pathname"
    label="Comment"
    theme="github-light"
    crossorigin="anonymous"
    async>
  </script>
</div>


    <div class="post-footer">
        
            
                <div class="post-tags">
                    
                        <a href="https:&#x2F;&#x2F;eastfisher.github.io&#x2F;blg&#x2F;tags&#x2F;golang&#x2F;">#Golang</a>
                    
                        <a href="https:&#x2F;&#x2F;eastfisher.github.io&#x2F;blg&#x2F;tags&#x2F;dingo&#x2F;">#Dingo</a>
                    
                        <a href="https:&#x2F;&#x2F;eastfisher.github.io&#x2F;blg&#x2F;tags&#x2F;dependency-injection&#x2F;">#Dependency Injection</a>
                    
                </div>
            
            
                <div class="post-nav">
                    
                        <a class="previous" href="https:&#x2F;&#x2F;eastfisher.github.io&#x2F;blg&#x2F;temporal-in-action-1&#x2F;">‹ Temporal实战 (1) 简介</a>
                    
                    
                        <a class="next" href="https:&#x2F;&#x2F;eastfisher.github.io&#x2F;blg&#x2F;temporal-in-action-3&#x2F;">Temporal实战 (3) 访问安全性 ›</a>
                    
                    
                    
                </div>
            

        

    </div>

    
    
</article>


                </div>
            </main>

            
            
        </div>

      

          <script type="text/javascript" src="https:&#x2F;&#x2F;eastfisher.github.io&#x2F;blg&#x2F;even.js" ></script>
      
<script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
<script>mermaid.initialize({startOnLoad:true});</script>

    </body>

</html>
